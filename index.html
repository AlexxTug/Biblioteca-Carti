<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Biblioteca Mea</title>
<style>
:root{
  --bg:#f5f7fa; --card:#fff; --text:#222; --accent:#4b3f72; --accent-hover:#6c5ca0; --muted:#666; --btn-bg:#4b3f72; --btn-color:#fff;
}
body.dark{ --bg:#12121a; --card:#1e1e2b; --text:#e6e6e6; --accent:#8b7cd1; --accent-hover:#a69bf0; --muted:#aaa; --btn-bg:#8b7cd1; --btn-color:#fff; }
body{margin:0;font-family:Inter,'Segoe UI',sans-serif;background:var(--bg);color:var(--text);transition:background 0.4s ease, color 0.4s ease;}
.header{position:sticky;top:0;background:var(--card);display:flex;align-items:center;justify-content:space-between;padding:12px 18px;box-shadow:0 2px 10px rgba(0,0,0,0.06);z-index:50;transition:background 0.4s ease, box-shadow 0.4s ease;}
.header-left h1{margin:0;font-size:26px;font-weight:700;color:var(--accent)}
.header-right{display:flex;align-items:center;gap:8px}
.header-right input[type=text],.header-right select{height:36px;padding:6px 8px;border-radius:8px;border:1px solid #ccc;background:var(--card);color:var(--text);transition:background 0.4s ease, color 0.4s ease, border 0.4s ease;}
.header-right button{height:36px;padding:6px 12px;border-radius:8px;border:0;background:var(--btn-bg);color:var(--btn-color);cursor:pointer;transition:background .2s, color .2s}
.header-right button:hover{background:var(--accent-hover)}
.header-right button.secondary{background:transparent;color:var(--accent);border:1px solid var(--accent)}
.container{max-width:820px;margin:18px auto;padding:0 14px}
#addBookForm{display:none;margin-bottom:18px;background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.06);transition:background 0.4s ease;}
#addBookForm input,#addBookForm textarea,#addBookForm select{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin-bottom:10px}
#books{display:flex;flex-direction:column;gap:14px}
.book{display:flex;gap:14px;padding:14px;border-radius:12px;background:var(--card);box-shadow:0 6px 18px rgba(0,0,0,0.04);align-items:flex-start;transition:background 0.4s ease;}
.book img{width:110px;height:150px;object-fit:cover;border-radius:6px;flex-shrink:0}
.book-content{flex:1}
.book-content h3{margin:0 0 6px;color:var(--accent)}
.book-content p{margin:6px 0;color:var(--muted)}
.stars{color:#f5a623;font-weight:600}
.actions{display:flex;gap:8px;margin-top:8px}
.actions button{padding:6px 10px;border-radius:6px;border:0;background:var(--btn-bg);color:var(--btn-color);cursor:pointer;transition:background .2s}
.actions button.ghost{background:transparent;color:var(--accent);border:1px solid #ddd}
.modal{display:none;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);}
.modal .card{background:var(--card);padding:18px;border-radius:12px;width:94%;max-width:520px;box-shadow:0 8px 20px rgba(0,0,0,0.3);transition:background 0.4s ease;}
.modal .card h3{margin-top:0;color:var(--accent)}
.modal .card input,.modal .card textarea{width:100%;padding:10px;margin-bottom:10px;border-radius:8px;border:1px solid #ccc;background:var(--card);color:var(--text)}
.modal .card button{padding:8px 12px;border-radius:8px;margin-left:8px;border:0;background:var(--btn-bg);color:var(--btn-color)}
.toast{position:fixed;right:18px;bottom:18px;padding:10px 14px;border-radius:10px;background:var(--accent);color:#fff;display:none}
</style>
</head>
<body>
<header class="header">
  <div class="header-left"><h1>üìö Biblioteca Mea</h1></div>
  <div class="header-right">
    <input id="search" type="text" placeholder="CautƒÉ titlu sau autor">
    <select id="filterRating">
      <option value="">Toate ratingurile</option>
      <option value="7">Peste 7</option>
      <option value="5">Peste 5</option>
    </select>
    <select id="sort">
      <option value="">SorteazƒÉ dupƒÉ</option>
      <option value="title">Titlu</option>
      <option value="author">Autor</option>
      <option value="rating">Rating</option>
    </select>
    <button id="showFormBtn">‚ûï AdaugƒÉ carte</button>
    <button id="toggleTheme" class="secondary">üåô</button>
  </div>
</header>

<main class="container">
  <form id="addBookForm">
    <input id="title" placeholder="Titlul cƒÉr»õii" required>
    <input id="author" placeholder="Autorul" required>
    <textarea id="review" rows="4" placeholder="Recenzia"></textarea>
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
      <label>Rating:</label><div id="ratingInput" style="display:flex;gap:4px"></div>
    </div>
    <input id="cover" placeholder="URL copertƒÉ (op»õional)">
    <div style="text-align:right"><button type="submit">AdaugƒÉ cartea</button></div>
  </form>
  <section id="books"></section>
</main>

<div id="editModal" class="modal">
  <div class="card">
    <h3>EditeazƒÉ cartea</h3>
    <form id="editBookForm">
      <input id="editTitle" required>
      <input id="editAuthor" required>
      <textarea id="editReview" rows="4"></textarea>
      <div style="display:flex;align-items:center;gap:8px;margin:10px 0"><label>Rating:</label><div id="editRatingStars" style="display:flex;gap:4px"></div></div>
      <input id="editCover" placeholder="URL copertƒÉ (op»õional)">
      <div style="text-align:right"><button type="button" id="cancelEdit">AnuleazƒÉ</button><button type="submit">SalveazƒÉ</button></div>
    </form>
  </div>
</div>

<div id="toast" class="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
const firebaseConfig={apiKey:"AIzaSyBaWRxJGw_Urngf3PCJEDliUHzr3AeuRZ4",authDomain:"biblioteca-carti.firebaseapp.com",projectId:"biblioteca-carti",storageBucket:"biblioteca-carti.firebasestorage.app",messagingSenderId:"371218386893",appId:"1:371218386893:web:4dc3632bfd7d0e74ccbe84"};
const app=initializeApp(firebaseConfig);const db=getFirestore(app);
const PASSWORD="marrons";

const showFormBtn=document.getElementById('showFormBtn');
const addBookForm=document.getElementById('addBookForm');
const books=document.getElementById('books');
const search=document.getElementById('search');
const filterRating=document.getElementById('filterRating');
const sort=document.getElementById('sort');
const toast=document.getElementById('toast');
const toggleTheme=document.getElementById('toggleTheme');
const ratingInput=document.getElementById('ratingInput');
const editRatingStars=document.getElementById('editRatingStars');
const editModal=document.getElementById('editModal');
const editBookForm=document.getElementById('editBookForm');
const cancelEdit=document.getElementById('cancelEdit');

let currentRating=0,currentEditRating=0,currentBookId=null,editingAllowed=false;

function showToast(m){toast.textContent=m;toast.style.display='block';setTimeout(()=>toast.style.display='none',1800)}
function renderStars(c,v,cb){c.innerHTML='';for(let i=1;i<=10;i++){let s=document.createElement('span');s.textContent=i<=v?'‚≠ê':'‚òÜ';s.style.cursor='pointer';s.onclick=()=>{cb(i);renderStars(c,i,cb)};c.appendChild(s)}}
renderStars(ratingInput,0,(v)=>currentRating=v);renderStars(editRatingStars,0,(v)=>currentEditRating=v);

const saved=localStorage.getItem('theme');if(saved==='dark')document.body.classList.add('dark');
if(document.body.classList.contains('dark'))toggleTheme.textContent='‚òÄÔ∏è';
toggleTheme.onclick=()=>{document.body.classList.toggle('dark');const d=document.body.classList.contains('dark');toggleTheme.textContent=d?'‚òÄÔ∏è':'üåô';localStorage.setItem('theme',d?'dark':'light')}

showFormBtn.onclick=()=>{addBookForm.style.display=addBookForm.style.display==='none'?'block':'none'}

addBookForm.onsubmit=async e=>{e.preventDefault();const pw=prompt('Introdu parola pentru a adƒÉuga cartea:');if(pw!==PASSWORD){alert('Parola incorectƒÉ');return}await addDoc(collection(db,'books'),{title:title.value,author:author.value,review:review.value,rating:currentRating||0,cover:cover.value});addBookForm.reset();currentRating=0;renderStars(ratingInput,0,v=>currentRating=v);addBookForm.style.display='none';loadBooks();showToast('Cartea adƒÉugatƒÉ')}

async function loadBooks(){books.innerHTML='';let arr=[];(await getDocs(collection(db,'books'))).forEach(d=>arr.push({id:d.id,...d.data()}));const q=search.value.toLowerCase().trim();if(q)arr=arr.filter(b=>b.title.toLowerCase().includes(q)||b.author.toLowerCase().includes(q));if(filterRating.value)arr=arr.filter(b=>(b.rating||0)>=+filterRating.value);if(sort.value){if(sort.value==='rating')arr.sort((a,b)=>b.rating-a.rating);else arr.sort((a,b)=>(''+(a[sort.value]||'')).localeCompare(b[sort.value]||''))}
arr.forEach(b=>{const el=document.createElement('div');el.className='book';el.innerHTML=`${b.cover?`<img src="${b.cover}">`:'<div style="width:110px;height:150px;background:#eee;border-radius:6px"></div>'}<div class="book-content"><h3>${b.title}</h3><p><strong>${b.author}</strong></p><p>${b.review||''}</p><div class="stars">${'‚≠ê'.repeat(b.rating||0)}${'‚òÜ'.repeat(10-(b.rating||0))} ${b.rating||0}/10</div><div class="actions"><button class="editBtn">‚úèÔ∏è EditeazƒÉ</button><button class="deleteBtn ghost">üóëÔ∏è »òterge</button></div></div>`;
el.querySelector('.editBtn').onclick=()=>{if(!editingAllowed){const pw=prompt('Introdu parola pentru editare:');if(pw!==PASSWORD){alert('Parola incorectƒÉ');return}editingAllowed=true}currentBookId=b.id;editTitle.value=b.title;editAuthor.value=b.author;editReview.value=b.review;editCover.value=b.cover;currentEditRating=b.rating||0;renderStars(editRatingStars,currentEditRating,v=>currentEditRating=v);editModal.style.display='flex'};
el.querySelector('.deleteBtn').onclick=async()=>{const pw=prompt('Introdu parola pentru »ôtergere:');if(pw!==PASSWORD){alert('Parola incorectƒÉ');return}await deleteDoc(doc(db,'books',b.id));loadBooks();showToast('Cartea »ôtearsƒÉ')};books.appendChild(el)})}

editBookForm.onsubmit=async e=>{e.preventDefault();await updateDoc(doc(db,'books',currentBookId),{title:editTitle.value,author:editAuthor.value,review:editReview.value,cover:editCover.value,rating:currentEditRating});editModal.style.display='none';loadBooks();showToast('Cartea actualizatƒÉ')}

cancelEdit.onclick=()=>editModal.style.display='none'

search.oninput=()=>loadBooks();filterRating.onchange=()=>loadBooks();sort.onchange=()=>loadBooks();
loadBooks()
</script>
</body>
</html>
